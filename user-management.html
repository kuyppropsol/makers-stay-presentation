<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>User Management - The Maker's Stay Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #182719 0%, #1a2f1b 100%);
            color: #F5f2e8;
        }

        .playfair {
            font-family: 'Playfair Display', serif;
        }

        .text-accent {
            color: #Bca86d;
        }

        .bg-accent {
            background-color: #Bca86d;
        }

        .card-style {
            background-color: rgba(245, 242, 232, 0.1);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(188, 168, 109, 0.2);
        }

        .status-approved {
            color: #10B981;
        }

        .status-pending {
            color: #F59E0B;
        }

        .status-rejected {
            color: #EF4444;
        }
    </style>
</head>

<body class="min-h-screen p-6">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <header class="mb-8">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-4xl font-bold playfair text-accent mb-2">User Management</h1>
                    <p class="text-gray-300">Manage investor and team member accounts</p>
                </div>
                <div class="flex space-x-4">
                    <a href="admin-dashboard.html" class="text-accent hover:text-yellow-300">‚Üê Back to Dashboard</a>
                    <button onclick="refreshData()"
                        class="bg-accent text-black px-4 py-2 rounded font-medium hover:bg-yellow-600 transition-colors">
                        üîÑ Refresh
                    </button>
                </div>
            </div>
        </header>

        <!-- Stats Cards -->
        <div class="grid md:grid-cols-4 gap-6 mb-8">
            <div class="card-style p-6 rounded-xl text-center">
                <div class="text-3xl font-bold text-accent" id="totalUsers">0</div>
                <div class="text-sm text-gray-300">Total Users</div>
            </div>
            <div class="card-style p-6 rounded-xl text-center">
                <div class="text-3xl font-bold status-pending" id="pendingUsers">0</div>
                <div class="text-sm text-gray-300">Pending Approval</div>
            </div>
            <div class="card-style p-6 rounded-xl text-center">
                <div class="text-3xl font-bold status-approved" id="activeInvestors">0</div>
                <div class="text-sm text-gray-300">Active Investors</div>
            </div>
            <div class="card-style p-6 rounded-xl text-center">
                <div class="text-3xl font-bold text-accent" id="teamMembers">0</div>
                <div class="text-sm text-gray-300">Team Members</div>
            </div>
        </div>

        <!-- Filters -->
        <div class="card-style p-6 rounded-xl mb-6">
            <div class="flex flex-wrap gap-4 items-center">
                <div>
                    <label class="block text-sm font-medium mb-2">Filter by Type:</label>
                    <select id="typeFilter" class="bg-gray-700 text-white p-2 rounded">
                        <option value="all">All Users</option>
                        <option value="investor">Investors</option>
                        <option value="team">Team Members</option>
                        <option value="visitor">Temporary Visitors</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Filter by Status:</label>
                    <select id="statusFilter" class="bg-gray-700 text-white p-2 rounded">
                        <option value="all">All Status</option>
                        <option value="approved">Approved</option>
                        <option value="pending">Pending</option>
                        <option value="rejected">Rejected</option>
                    </select>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-2">Search:</label>
                    <input type="text" id="searchInput" placeholder="Name or email..."
                        class="bg-gray-700 text-white p-2 rounded w-48">
                </div>
            </div>
        </div>

        <!-- Users Table -->
        <div class="card-style rounded-xl overflow-hidden">
            <div class="p-6 border-b border-gray-600">
                <h2 class="text-2xl font-bold playfair text-accent">User Accounts</h2>
            </div>

            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead class="bg-gray-800">
                        <tr>
                            <th class="text-left p-4 font-medium">Name</th>
                            <th class="text-left p-4 font-medium">Email</th>
                            <th class="text-left p-4 font-medium">Type</th>
                            <th class="text-left p-4 font-medium">Status</th>
                            <th class="text-left p-4 font-medium">Created</th>
                            <th class="text-left p-4 font-medium">Investment Range</th>
                            <th class="text-left p-4 font-medium">Actions</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                        <!-- Users will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- User Detail Modal -->
        <div id="userModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-6"
            style="display: none;">
            <div class="card-style p-8 rounded-xl max-w-2xl w-full max-h-96 overflow-y-auto">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-bold playfair text-accent">User Details</h3>
                    <button onclick="closeModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
                </div>
                <div id="userModalContent">
                    <!-- User details will be populated here -->
                </div>
            </div>
        </div>
    </div>

    <script>
        let allUsers = [];

        // Initialize the page
        window.addEventListener('load', function () {
            loadUsers();
            setupFilters();
        });

        // Load users from localStorage (in production, this would be from server)
        function loadUsers() {
            allUsers = [];

            // Load registered users
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('user_')) {
                    try {
                        const userData = JSON.parse(localStorage.getItem(key));
                        allUsers.push(userData);
                    } catch (e) {
                        console.error('Error parsing user data:', e);
                    }
                }
            }

            // Load temporary visitors
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key.startsWith('tempAccess_')) {
                    try {
                        const tempData = JSON.parse(localStorage.getItem(key));
                        allUsers.push({
                            ...tempData,
                            accountType: 'visitor',
                            approved: true,
                            firstName: tempData.fullName.split(' ')[0],
                            lastName: tempData.fullName.split(' ').slice(1).join(' '),
                            registerEmail: tempData.email,
                            createdAt: new Date().toISOString(),
                            isTemporary: true
                        });
                    } catch (e) {
                        console.error('Error parsing temp user data:', e);
                    }
                }
            }

            updateStats();
            displayUsers(allUsers);
        }

        // Update statistics
        function updateStats() {
            const totalUsers = allUsers.length;
            const pendingUsers = allUsers.filter(u => !u.approved && !u.isTemporary).length;
            const activeInvestors = allUsers.filter(u => u.accountType === 'investor' && u.approved).length;
            const teamMembers = allUsers.filter(u => u.accountType === 'team' && u.approved).length;

            document.getElementById('totalUsers').textContent = totalUsers;
            document.getElementById('pendingUsers').textContent = pendingUsers;
            document.getElementById('activeInvestors').textContent = activeInvestors;
            document.getElementById('teamMembers').textContent = teamMembers;
        }

        // Display users in table
        function displayUsers(users) {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';

            users.forEach(user => {
                const row = document.createElement('tr');
                row.className = 'border-b border-gray-700 hover:bg-gray-800';

                const statusClass = user.approved ? 'status-approved' : 'status-pending';
                const statusText = user.approved ? 'Approved' : 'Pending';
                const investmentRange = user.investmentRange || 'N/A';

                row.innerHTML = `
                    <td class="p-4">${user.firstName} ${user.lastName}</td>
                    <td class="p-4">${user.registerEmail}</td>
                    <td class="p-4">
                        <span class="px-2 py-1 text-xs rounded-full bg-gray-700">
                            ${user.accountType === 'investor' ? 'üíº Investor' :
                        user.accountType === 'team' ? 'üîê Team' : 'üåü Visitor'}
                        </span>
                    </td>
                    <td class="p-4">
                        <span class="${statusClass} font-medium">${statusText}</span>
                    </td>
                    <td class="p-4 text-sm text-gray-400">
                        ${new Date(user.createdAt).toLocaleDateString()}
                    </td>
                    <td class="p-4 text-sm">${investmentRange}</td>
                    <td class="p-4">
                        <div class="flex space-x-2">
                            <button onclick="viewUser('${user.registerEmail}')" 
                                class="text-accent hover:text-yellow-300 text-sm">View</button>
                            ${!user.approved && !user.isTemporary ?
                        `<button onclick="approveUser('${user.registerEmail}')" 
                                    class="text-green-400 hover:text-green-300 text-sm">Approve</button>` : ''}
                            ${user.accountType !== 'visitor' ?
                        `<button onclick="deleteUser('${user.registerEmail}')" 
                                    class="text-red-400 hover:text-red-300 text-sm">Delete</button>` : ''}
                        </div>
                    </td>
                `;

                tbody.appendChild(row);
            });
        }

        // Setup filters
        function setupFilters() {
            document.getElementById('typeFilter').addEventListener('change', applyFilters);
            document.getElementById('statusFilter').addEventListener('change', applyFilters);
            document.getElementById('searchInput').addEventListener('input', applyFilters);
        }

        // Apply filters
        function applyFilters() {
            const typeFilter = document.getElementById('typeFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();

            let filteredUsers = allUsers;

            // Filter by type
            if (typeFilter !== 'all') {
                filteredUsers = filteredUsers.filter(user => user.accountType === typeFilter);
            }

            // Filter by status
            if (statusFilter !== 'all') {
                if (statusFilter === 'approved') {
                    filteredUsers = filteredUsers.filter(user => user.approved);
                } else if (statusFilter === 'pending') {
                    filteredUsers = filteredUsers.filter(user => !user.approved);
                }
            }

            // Search filter
            if (searchTerm) {
                filteredUsers = filteredUsers.filter(user =>
                    user.firstName.toLowerCase().includes(searchTerm) ||
                    user.lastName.toLowerCase().includes(searchTerm) ||
                    user.registerEmail.toLowerCase().includes(searchTerm)
                );
            }

            displayUsers(filteredUsers);
        }

        // View user details
        function viewUser(email) {
            const user = allUsers.find(u => u.registerEmail === email);
            if (!user) return;

            const modalContent = document.getElementById('userModalContent');
            modalContent.innerHTML = `
                <div class="space-y-4">
                    <div class="grid md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-accent">Name</label>
                            <p class="text-lg">${user.firstName} ${user.lastName}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-accent">Email</label>
                            <p class="text-lg">${user.registerEmail}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-accent">Phone</label>
                            <p class="text-lg">${user.phone || 'N/A'}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-accent">Account Type</label>
                            <p class="text-lg">${user.accountType}</p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-accent">Status</label>
                            <p class="text-lg ${user.approved ? 'status-approved' : 'status-pending'}">
                                ${user.approved ? 'Approved' : 'Pending'}
                            </p>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-accent">Created</label>
                            <p class="text-lg">${new Date(user.createdAt).toLocaleString()}</p>
                        </div>
                    </div>
                    
                    ${user.accountType === 'investor' ? `
                        <div>
                            <label class="block text-sm font-medium text-accent">Investment Details</label>
                            <div class="mt-2 p-4 bg-gray-800 rounded">
                                <p><strong>Experience:</strong> ${user.experience || 'N/A'}</p>
                                <p><strong>Investment Range:</strong> ${user.investmentRange || 'N/A'}</p>
                            </div>
                        </div>
                    ` : ''}
                    
                    ${user.accountType === 'team' ? `
                        <div>
                            <label class="block text-sm font-medium text-accent">Team Details</label>
                            <div class="mt-2 p-4 bg-gray-800 rounded">
                                <p><strong>Role:</strong> ${user.role || 'N/A'}</p>
                            </div>
                        </div>
                    ` : ''}
                    
                    <div class="flex justify-end space-x-4 mt-6">
                        ${!user.approved && !user.isTemporary ?
                    `<button onclick="approveUser('${user.registerEmail}')" 
                                class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded">
                                Approve User
                            </button>` : ''}
                        <button onclick="closeModal()" 
                            class="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded">
                            Close
                        </button>
                    </div>
                </div>
            `;

            document.getElementById('userModal').style.display = 'flex';
        }

        // Approve user
        function approveUser(email) {
            const userKey = 'user_' + email;
            const userData = localStorage.getItem(userKey);
            if (userData) {
                const user = JSON.parse(userData);
                user.approved = true;
                user.approvedAt = new Date().toISOString();
                localStorage.setItem(userKey, JSON.stringify(user));

                alert(`User ${user.firstName} ${user.lastName} has been approved!`);
                loadUsers();
                closeModal();
            }
        }

        // Delete user
        function deleteUser(email) {
            if (confirm('Are you sure you want to delete this user? This action cannot be undone.')) {
                const userKey = 'user_' + email;
                localStorage.removeItem(userKey);

                // Also remove temp access if exists
                const tempKey = 'tempAccess_' + email;
                localStorage.removeItem(tempKey);

                alert('User deleted successfully.');
                loadUsers();
            }
        }

        // Close modal
        function closeModal() {
            document.getElementById('userModal').style.display = 'none';
        }

        // Refresh data
        function refreshData() {
            loadUsers();
            alert('User data refreshed!');
        }

        // Close modal when clicking outside
        document.getElementById('userModal').addEventListener('click', function (e) {
            if (e.target === this) {
                closeModal();
            }
        });
    </script>
</body>

</html>